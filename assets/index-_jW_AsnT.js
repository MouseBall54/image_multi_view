var Et=Object.defineProperty;var It=(i,t,e)=>t in i?Et(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var P=(i,t,e)=>It(i,typeof t!="symbol"?t+"":t,e);const Q={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},it={};for(const i in Q)it[Q[i]]=Number(i);const Dt=Object.freeze(Object.defineProperty({__proto__:null,tagsById:Q,tagsByName:it},Symbol.toStringTag,{value:"Module"})),q={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},nt={};for(const i in q)nt[q[i]]=Number(i);const At=Object.freeze(Object.defineProperty({__proto__:null,tagsById:q,tagsByName:nt},Symbol.toStringTag,{value:"Module"})),ee={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},at={};for(const i in ee)at[ee[i]]=Number(i);const Pt=Object.freeze(Object.defineProperty({__proto__:null,tagsById:ee,tagsByName:at},Symbol.toStringTag,{value:"Module"}));function pe(i,t="utf8"){return new TextDecoder(t).decode(i)}const vt=new TextEncoder;function Tt(i){return vt.encode(i)}const Ct=1024*8,Bt=(()=>{const i=new Uint8Array(4),t=new Uint32Array(i.buffer);return!((t[0]=1)&i[0])})(),re={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class ie{constructor(t=Ct,e={}){P(this,"buffer");P(this,"byteLength");P(this,"byteOffset");P(this,"length");P(this,"offset");P(this,"lastWrittenByte");P(this,"littleEndian");P(this,"_data");P(this,"_mark");P(this,"_marks");let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const s=e.offset?e.offset>>>0:0,a=t.byteLength-s;let l=s;(ArrayBuffer.isView(t)||t instanceof ie)&&(t.byteLength!==t.buffer.byteLength&&(l=t.byteOffset+s),t=t.buffer),n?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=t,this.length=a,this.byteLength=a,this.byteOffset=l,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,l,a),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=n,this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const n=re[e].BYTES_PER_ELEMENT*t,s=this.byteOffset+this.offset,a=this.buffer.slice(s,s+n);if(this.littleEndian===Bt&&e!=="uint8"&&e!=="int8"){const f=new Uint8Array(this.buffer.slice(s,s+n));f.reverse();const b=new re[e](f.buffer);return this.offset+=n,b.reverse(),b}const l=new re[e](a);return this.offset+=n,l}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let n=0;n<t;n++)e+=this.readChar();return e}readUtf8(t=1){return pe(this.readBytes(t))}decodeText(t=1,e="utf8"){return pe(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(Tt(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Lt(i){if(i.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=i.rowsPerStrip*i.width*i.samplesPerPixel*(i.bitsPerSample/8);return new Array(i.stripOffsets.length).fill(t)}function Rt(i,t,e){let n=0;for(;n<i.length;){for(let s=e;s<t*e;s+=e)for(let a=0;a<e;a++)i[n+s+a]=i[n+s+a]+i[n+s-(e-a)]&255;n+=t*e}}function Mt(i,t,e){let n=0;for(;n<i.length;){for(let s=e;s<t*e;s+=e)for(let a=0;a<e;a++)i[n+s+a]=i[n+s+a]+i[n+s-(e-a)]&65535;n+=t*e}}const me={standard:Pt,exif:Dt,gps:At};class rt{constructor(t){P(this,"kind");P(this,"data");P(this,"fields");P(this,"exif");P(this,"gps");P(this,"_hasMap");P(this,"_map");if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(me[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=me[this.kind].tagsById;for(const e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}const st=new Map([[1,[1,ye]],[2,[1,Ot]],[3,[2,Nt]],[4,[4,Gt]],[5,[8,$t]],[6,[1,zt]],[7,[1,ye]],[8,[2,Ht]],[9,[4,Zt]],[10,[8,Wt]],[11,[4,Vt]],[12,[8,jt]]]);function Ft(i,t){const e=st.get(i);if(!e)throw new Error(`type not found: ${i}`);return e[0]*t}function Ut(i,t,e){const n=st.get(t);if(!n)throw new Error(`type not found: ${t}`);return n[1](i,e)}function ye(i,t){if(t===1)return i.readUint8();const e=new Uint8Array(t);for(let n=0;n<t;n++)e[n]=i.readUint8();return e}function Ot(i,t){const e=[];let n="";for(let s=0;s<t;s++){const a=String.fromCharCode(i.readUint8());a==="\0"?(e.push(n),n=""):n+=a}return e.length===1?e[0]:e}function Nt(i,t){if(t===1)return i.readUint16();const e=new Uint16Array(t);for(let n=0;n<t;n++)e[n]=i.readUint16();return e}function Gt(i,t){if(t===1)return i.readUint32();const e=new Uint32Array(t);for(let n=0;n<t;n++)e[n]=i.readUint32();return e}function $t(i,t){if(t===1)return i.readUint32()/i.readUint32();const e=new Array(t);for(let n=0;n<t;n++)e[n]=i.readUint32()/i.readUint32();return e}function zt(i,t){if(t===1)return i.readInt8();const e=new Int8Array(t);for(let n=0;n<t;n++)e[n]=i.readInt8();return e}function Ht(i,t){if(t===1)return i.readInt16();const e=new Int16Array(t);for(let n=0;n<t;n++)e[n]=i.readInt16();return e}function Zt(i,t){if(t===1)return i.readInt32();const e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=i.readInt32();return e}function Wt(i,t){if(t===1)return i.readInt32()/i.readInt32();const e=new Array(t);for(let n=0;n<t;n++)e[n]=i.readInt32()/i.readInt32();return e}function Vt(i,t){if(t===1)return i.readFloat32();const e=new Float32Array(t);for(let n=0;n<t;n++)e[n]=i.readFloat32();return e}function jt(i,t){if(t===1)return i.readFloat64();const e=new Float64Array(t);for(let n=0;n<t;n++)e[n]=i.readFloat64();return e}const Yt=256,_e=257,Se=258,ke=9;let F=[];function Xt(){if(F.length===0){for(let t=0;t<256;t++)F.push([t]);const i=[];for(let t=256;t<4096;t++)F.push(i)}}const Kt=[511,1023,2047,4095],Jt=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class Qt{constructor(t){P(this,"stripArray");P(this,"nextData",0);P(this,"nextBits",0);P(this,"bytePointer",0);P(this,"tableLength",Se);P(this,"currentBitLength",ke);P(this,"outData");this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new ie(t.byteLength),this.initializeTable()}decode(){let t=0,e=0;for(;(t=this.getNextCode())!==_e;)if(t===Yt){if(this.initializeTable(),t=this.getNextCode(),t===_e)break;this.writeString(this.stringFromCode(t)),e=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(e).concat(this.stringFromCode(t)[0])),e=t;else{const s=this.stringFromCode(e).concat(this.stringFromCode(e)[0]);this.writeString(s),this.addStringToTable(s),e=t}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){Xt(),this.tableLength=Se,this.currentBitLength=ke}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return F[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(F[this.tableLength++]=t,F.length>4096)throw F=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===Jt[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&Kt[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function qt(i){return new Qt(i).decode()}const ei=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class Ee extends rt{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){const t=new Date,e=ei.exec(this.dateTime);if(e===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),t.setHours(Number(e[4]),Number(e[5]),Number(e[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return N(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return N(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return N(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||2**this.bitsPerSample-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return N(this.get("SampleFormat")||1)[0]}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,e=this.get("ColorMap");if(!e)return;if(e.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const n=[];for(let s=0;s<t;s++)n.push([e[s],e[s+t],e[s+2*t]]);return n}get tileWidth(){return this.get("TileWidth")}get tileHeight(){return this.get("TileLength")}get tileOffsets(){return N(this.get("TileOffsets"))}get tileByteCounts(){return N(this.get("TileByteCounts"))}get tiled(){return this.tileWidth!==void 0&&this.tileHeight!==void 0&&this.tileOffsets!==void 0&&this.tileByteCounts!==void 0}}function N(i){return typeof i=="number"?[i]:i}function z(i){let t=i.length;for(;--t>=0;)i[t]=0}const ti=3,ii=258,ot=29,ni=256,ai=ni+1+ot,lt=30,ri=512,si=new Array((ai+2)*2);z(si);const oi=new Array(lt*2);z(oi);const li=new Array(ri);z(li);const fi=new Array(ii-ti+1);z(fi);const hi=new Array(ot);z(hi);const ci=new Array(lt);z(ci);const ui=(i,t,e,n)=>{let s=i&65535|0,a=i>>>16&65535|0,l=0;for(;e!==0;){l=e>2e3?2e3:e,e-=l;do s=s+t[n++]|0,a=a+s|0;while(--l);s%=65521,a%=65521}return s|a<<16|0};var xe=ui;const di=()=>{let i,t=[];for(var e=0;e<256;e++){i=e;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;t[e]=i}return t},xi=new Uint32Array(di()),gi=(i,t,e,n)=>{const s=xi,a=n+e;i^=-1;for(let l=n;l<a;l++)i=i>>>8^s[(i^t[l])&255];return i^-1};var C=gi,ge={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ft={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const bi=(i,t)=>Object.prototype.hasOwnProperty.call(i,t);var wi=function(i){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)bi(e,n)&&(i[n]=e[n])}}return i},pi=i=>{let t=0;for(let n=0,s=i.length;n<s;n++)t+=i[n].length;const e=new Uint8Array(t);for(let n=0,s=0,a=i.length;n<a;n++){let l=i[n];e.set(l,s),s+=l.length}return e},ht={assign:wi,flattenChunks:pi};let ct=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ct=!1}const Z=new Uint8Array(256);for(let i=0;i<256;i++)Z[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;Z[254]=Z[254]=1;var mi=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let t,e,n,s,a,l=i.length,f=0;for(s=0;s<l;s++)e=i.charCodeAt(s),(e&64512)===55296&&s+1<l&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),f+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(f),a=0,s=0;a<f;s++)e=i.charCodeAt(s),(e&64512)===55296&&s+1<l&&(n=i.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),e<128?t[a++]=e:e<2048?(t[a++]=192|e>>>6,t[a++]=128|e&63):e<65536?(t[a++]=224|e>>>12,t[a++]=128|e>>>6&63,t[a++]=128|e&63):(t[a++]=240|e>>>18,t[a++]=128|e>>>12&63,t[a++]=128|e>>>6&63,t[a++]=128|e&63);return t};const yi=(i,t)=>{if(t<65534&&i.subarray&&ct)return String.fromCharCode.apply(null,i.length===t?i:i.subarray(0,t));let e="";for(let n=0;n<t;n++)e+=String.fromCharCode(i[n]);return e};var _i=(i,t)=>{const e=t||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,t));let n,s;const a=new Array(e*2);for(s=0,n=0;n<e;){let l=i[n++];if(l<128){a[s++]=l;continue}let f=Z[l];if(f>4){a[s++]=65533,n+=f-1;continue}for(l&=f===2?31:f===3?15:7;f>1&&n<e;)l=l<<6|i[n++]&63,f--;if(f>1){a[s++]=65533;continue}l<65536?a[s++]=l:(l-=65536,a[s++]=55296|l>>10&1023,a[s++]=56320|l&1023)}return yi(a,s)},Si=(i,t)=>{t=t||i.length,t>i.length&&(t=i.length);let e=t-1;for(;e>=0&&(i[e]&192)===128;)e--;return e<0||e===0?t:e+Z[i[e]]>t?e:t},be={string2buf:mi,buf2string:_i,utf8border:Si};function ki(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ei=ki;const Y=16209,Ii=16191;var Di=function(t,e){let n,s,a,l,f,b,r,o,E,x,h,d,D,p,g,k,y,c,_,A,u,I,S,w;const m=t.state;n=t.next_in,S=t.input,s=n+(t.avail_in-5),a=t.next_out,w=t.output,l=a-(e-t.avail_out),f=a+(t.avail_out-257),b=m.dmax,r=m.wsize,o=m.whave,E=m.wnext,x=m.window,h=m.hold,d=m.bits,D=m.lencode,p=m.distcode,g=(1<<m.lenbits)-1,k=(1<<m.distbits)-1;e:do{d<15&&(h+=S[n++]<<d,d+=8,h+=S[n++]<<d,d+=8),y=D[h&g];t:for(;;){if(c=y>>>24,h>>>=c,d-=c,c=y>>>16&255,c===0)w[a++]=y&65535;else if(c&16){_=y&65535,c&=15,c&&(d<c&&(h+=S[n++]<<d,d+=8),_+=h&(1<<c)-1,h>>>=c,d-=c),d<15&&(h+=S[n++]<<d,d+=8,h+=S[n++]<<d,d+=8),y=p[h&k];i:for(;;){if(c=y>>>24,h>>>=c,d-=c,c=y>>>16&255,c&16){if(A=y&65535,c&=15,d<c&&(h+=S[n++]<<d,d+=8,d<c&&(h+=S[n++]<<d,d+=8)),A+=h&(1<<c)-1,A>b){t.msg="invalid distance too far back",m.mode=Y;break e}if(h>>>=c,d-=c,c=a-l,A>c){if(c=A-c,c>o&&m.sane){t.msg="invalid distance too far back",m.mode=Y;break e}if(u=0,I=x,E===0){if(u+=r-c,c<_){_-=c;do w[a++]=x[u++];while(--c);u=a-A,I=w}}else if(E<c){if(u+=r+E-c,c-=E,c<_){_-=c;do w[a++]=x[u++];while(--c);if(u=0,E<_){c=E,_-=c;do w[a++]=x[u++];while(--c);u=a-A,I=w}}}else if(u+=E-c,c<_){_-=c;do w[a++]=x[u++];while(--c);u=a-A,I=w}for(;_>2;)w[a++]=I[u++],w[a++]=I[u++],w[a++]=I[u++],_-=3;_&&(w[a++]=I[u++],_>1&&(w[a++]=I[u++]))}else{u=a-A;do w[a++]=w[u++],w[a++]=w[u++],w[a++]=w[u++],_-=3;while(_>2);_&&(w[a++]=w[u++],_>1&&(w[a++]=w[u++]))}}else if(c&64){t.msg="invalid distance code",m.mode=Y;break e}else{y=p[(y&65535)+(h&(1<<c)-1)];continue i}break}}else if(c&64)if(c&32){m.mode=Ii;break e}else{t.msg="invalid literal/length code",m.mode=Y;break e}else{y=D[(y&65535)+(h&(1<<c)-1)];continue t}break}}while(n<s&&a<f);_=d>>3,n-=_,d-=_<<3,h&=(1<<d)-1,t.next_in=n,t.next_out=a,t.avail_in=n<s?5+(s-n):5-(n-s),t.avail_out=a<f?257+(f-a):257-(a-f),m.hold=h,m.bits=d};const G=15,Ie=852,De=592,Ae=0,se=1,Pe=2,Ai=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Pi=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),vi=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ti=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Ci=(i,t,e,n,s,a,l,f)=>{const b=f.bits;let r=0,o=0,E=0,x=0,h=0,d=0,D=0,p=0,g=0,k=0,y,c,_,A,u,I=null,S;const w=new Uint16Array(G+1),m=new Uint16Array(G+1);let M=null,we,V,j;for(r=0;r<=G;r++)w[r]=0;for(o=0;o<n;o++)w[t[e+o]]++;for(h=b,x=G;x>=1&&w[x]===0;x--);if(h>x&&(h=x),x===0)return s[a++]=1<<24|64<<16|0,s[a++]=1<<24|64<<16|0,f.bits=1,0;for(E=1;E<x&&w[E]===0;E++);for(h<E&&(h=E),p=1,r=1;r<=G;r++)if(p<<=1,p-=w[r],p<0)return-1;if(p>0&&(i===Ae||x!==1))return-1;for(m[1]=0,r=1;r<G;r++)m[r+1]=m[r]+w[r];for(o=0;o<n;o++)t[e+o]!==0&&(l[m[t[e+o]]++]=o);if(i===Ae?(I=M=l,S=20):i===se?(I=Ai,M=Pi,S=257):(I=vi,M=Ti,S=0),k=0,o=0,r=E,u=a,d=h,D=0,_=-1,g=1<<h,A=g-1,i===se&&g>Ie||i===Pe&&g>De)return 1;for(;;){we=r-D,l[o]+1<S?(V=0,j=l[o]):l[o]>=S?(V=M[l[o]-S],j=I[l[o]-S]):(V=96,j=0),y=1<<r-D,c=1<<d,E=c;do c-=y,s[u+(k>>D)+c]=we<<24|V<<16|j|0;while(c!==0);for(y=1<<r-1;k&y;)y>>=1;if(y!==0?(k&=y-1,k+=y):k=0,o++,--w[r]===0){if(r===x)break;r=t[e+l[o]]}if(r>h&&(k&A)!==_){for(D===0&&(D=h),u+=E,d=r-D,p=1<<d;d+D<x&&(p-=w[d+D],!(p<=0));)d++,p<<=1;if(g+=1<<d,i===se&&g>Ie||i===Pe&&g>De)return 1;_=k&A,s[_]=h<<24|d<<16|u-a|0}}return k!==0&&(s[u+k]=r-D<<24|64<<16|0),f.bits=h,0};var H=Ci;const Bi=0,ut=1,dt=2,{Z_FINISH:ve,Z_BLOCK:Li,Z_TREES:X,Z_OK:U,Z_STREAM_END:Ri,Z_NEED_DICT:Mi,Z_STREAM_ERROR:T,Z_DATA_ERROR:xt,Z_MEM_ERROR:gt,Z_BUF_ERROR:Fi,Z_DEFLATED:Te}=ft,ne=16180,Ce=16181,Be=16182,Le=16183,Re=16184,Me=16185,Fe=16186,Ue=16187,Oe=16188,Ne=16189,te=16190,B=16191,oe=16192,Ge=16193,le=16194,$e=16195,ze=16196,He=16197,Ze=16198,K=16199,J=16200,We=16201,Ve=16202,je=16203,Ye=16204,Xe=16205,fe=16206,Ke=16207,Je=16208,v=16209,bt=16210,wt=16211,Ui=852,Oi=592,Ni=15,Gi=Ni,Qe=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function $i(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const O=i=>{if(!i)return 1;const t=i.state;return!t||t.strm!==i||t.mode<ne||t.mode>wt?1:0},pt=i=>{if(O(i))return T;const t=i.state;return i.total_in=i.total_out=t.total=0,i.msg="",t.wrap&&(i.adler=t.wrap&1),t.mode=ne,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(Ui),t.distcode=t.distdyn=new Int32Array(Oi),t.sane=1,t.back=-1,U},mt=i=>{if(O(i))return T;const t=i.state;return t.wsize=0,t.whave=0,t.wnext=0,pt(i)},yt=(i,t)=>{let e;if(O(i))return T;const n=i.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?T:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=e,n.wbits=t,mt(i))},_t=(i,t)=>{if(!i)return T;const e=new $i;i.state=e,e.strm=i,e.window=null,e.mode=ne;const n=yt(i,t);return n!==U&&(i.state=null),n},zi=i=>_t(i,Gi);let qe=!0,he,ce;const Hi=i=>{if(qe){he=new Int32Array(512),ce=new Int32Array(32);let t=0;for(;t<144;)i.lens[t++]=8;for(;t<256;)i.lens[t++]=9;for(;t<280;)i.lens[t++]=7;for(;t<288;)i.lens[t++]=8;for(H(ut,i.lens,0,288,he,0,i.work,{bits:9}),t=0;t<32;)i.lens[t++]=5;H(dt,i.lens,0,32,ce,0,i.work,{bits:5}),qe=!1}i.lencode=he,i.lenbits=9,i.distcode=ce,i.distbits=5},St=(i,t,e,n)=>{let s;const a=i.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(t.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>n&&(s=n),a.window.set(t.subarray(e-n,e-n+s),a.wnext),n-=s,n?(a.window.set(t.subarray(e-n,e),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0},Zi=(i,t)=>{let e,n,s,a,l,f,b,r,o,E,x,h,d,D,p=0,g,k,y,c,_,A,u,I;const S=new Uint8Array(4);let w,m;const M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(O(i)||!i.output||!i.input&&i.avail_in!==0)return T;e=i.state,e.mode===B&&(e.mode=oe),l=i.next_out,s=i.output,b=i.avail_out,a=i.next_in,n=i.input,f=i.avail_in,r=e.hold,o=e.bits,E=f,x=b,I=U;e:for(;;)switch(e.mode){case ne:if(e.wrap===0){e.mode=oe;break}for(;o<16;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if(e.wrap&2&&r===35615){e.wbits===0&&(e.wbits=15),e.check=0,S[0]=r&255,S[1]=r>>>8&255,e.check=C(e.check,S,2,0),r=0,o=0,e.mode=Ce;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((r&255)<<8)+(r>>8))%31){i.msg="incorrect header check",e.mode=v;break}if((r&15)!==Te){i.msg="unknown compression method",e.mode=v;break}if(r>>>=4,o-=4,u=(r&15)+8,e.wbits===0&&(e.wbits=u),u>15||u>e.wbits){i.msg="invalid window size",e.mode=v;break}e.dmax=1<<e.wbits,e.flags=0,i.adler=e.check=1,e.mode=r&512?Ne:B,r=0,o=0;break;case Ce:for(;o<16;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if(e.flags=r,(e.flags&255)!==Te){i.msg="unknown compression method",e.mode=v;break}if(e.flags&57344){i.msg="unknown header flags set",e.mode=v;break}e.head&&(e.head.text=r>>8&1),e.flags&512&&e.wrap&4&&(S[0]=r&255,S[1]=r>>>8&255,e.check=C(e.check,S,2,0)),r=0,o=0,e.mode=Be;case Be:for(;o<32;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}e.head&&(e.head.time=r),e.flags&512&&e.wrap&4&&(S[0]=r&255,S[1]=r>>>8&255,S[2]=r>>>16&255,S[3]=r>>>24&255,e.check=C(e.check,S,4,0)),r=0,o=0,e.mode=Le;case Le:for(;o<16;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}e.head&&(e.head.xflags=r&255,e.head.os=r>>8),e.flags&512&&e.wrap&4&&(S[0]=r&255,S[1]=r>>>8&255,e.check=C(e.check,S,2,0)),r=0,o=0,e.mode=Re;case Re:if(e.flags&1024){for(;o<16;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}e.length=r,e.head&&(e.head.extra_len=r),e.flags&512&&e.wrap&4&&(S[0]=r&255,S[1]=r>>>8&255,e.check=C(e.check,S,2,0)),r=0,o=0}else e.head&&(e.head.extra=null);e.mode=Me;case Me:if(e.flags&1024&&(h=e.length,h>f&&(h=f),h&&(e.head&&(u=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(a,a+h),u)),e.flags&512&&e.wrap&4&&(e.check=C(e.check,n,h,a)),f-=h,a+=h,e.length-=h),e.length))break e;e.length=0,e.mode=Fe;case Fe:if(e.flags&2048){if(f===0)break e;h=0;do u=n[a+h++],e.head&&u&&e.length<65536&&(e.head.name+=String.fromCharCode(u));while(u&&h<f);if(e.flags&512&&e.wrap&4&&(e.check=C(e.check,n,h,a)),f-=h,a+=h,u)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Ue;case Ue:if(e.flags&4096){if(f===0)break e;h=0;do u=n[a+h++],e.head&&u&&e.length<65536&&(e.head.comment+=String.fromCharCode(u));while(u&&h<f);if(e.flags&512&&e.wrap&4&&(e.check=C(e.check,n,h,a)),f-=h,a+=h,u)break e}else e.head&&(e.head.comment=null);e.mode=Oe;case Oe:if(e.flags&512){for(;o<16;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if(e.wrap&4&&r!==(e.check&65535)){i.msg="header crc mismatch",e.mode=v;break}r=0,o=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),i.adler=e.check=0,e.mode=B;break;case Ne:for(;o<32;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}i.adler=e.check=Qe(r),r=0,o=0,e.mode=te;case te:if(e.havedict===0)return i.next_out=l,i.avail_out=b,i.next_in=a,i.avail_in=f,e.hold=r,e.bits=o,Mi;i.adler=e.check=1,e.mode=B;case B:if(t===Li||t===X)break e;case oe:if(e.last){r>>>=o&7,o-=o&7,e.mode=fe;break}for(;o<3;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}switch(e.last=r&1,r>>>=1,o-=1,r&3){case 0:e.mode=Ge;break;case 1:if(Hi(e),e.mode=K,t===X){r>>>=2,o-=2;break e}break;case 2:e.mode=ze;break;case 3:i.msg="invalid block type",e.mode=v}r>>>=2,o-=2;break;case Ge:for(r>>>=o&7,o-=o&7;o<32;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if((r&65535)!==(r>>>16^65535)){i.msg="invalid stored block lengths",e.mode=v;break}if(e.length=r&65535,r=0,o=0,e.mode=le,t===X)break e;case le:e.mode=$e;case $e:if(h=e.length,h){if(h>f&&(h=f),h>b&&(h=b),h===0)break e;s.set(n.subarray(a,a+h),l),f-=h,a+=h,b-=h,l+=h,e.length-=h;break}e.mode=B;break;case ze:for(;o<14;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if(e.nlen=(r&31)+257,r>>>=5,o-=5,e.ndist=(r&31)+1,r>>>=5,o-=5,e.ncode=(r&15)+4,r>>>=4,o-=4,e.nlen>286||e.ndist>30){i.msg="too many length or distance symbols",e.mode=v;break}e.have=0,e.mode=He;case He:for(;e.have<e.ncode;){for(;o<3;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}e.lens[M[e.have++]]=r&7,r>>>=3,o-=3}for(;e.have<19;)e.lens[M[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,w={bits:e.lenbits},I=H(Bi,e.lens,0,19,e.lencode,0,e.work,w),e.lenbits=w.bits,I){i.msg="invalid code lengths set",e.mode=v;break}e.have=0,e.mode=Ze;case Ze:for(;e.have<e.nlen+e.ndist;){for(;p=e.lencode[r&(1<<e.lenbits)-1],g=p>>>24,k=p>>>16&255,y=p&65535,!(g<=o);){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if(y<16)r>>>=g,o-=g,e.lens[e.have++]=y;else{if(y===16){for(m=g+2;o<m;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if(r>>>=g,o-=g,e.have===0){i.msg="invalid bit length repeat",e.mode=v;break}u=e.lens[e.have-1],h=3+(r&3),r>>>=2,o-=2}else if(y===17){for(m=g+3;o<m;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}r>>>=g,o-=g,u=0,h=3+(r&7),r>>>=3,o-=3}else{for(m=g+7;o<m;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}r>>>=g,o-=g,u=0,h=11+(r&127),r>>>=7,o-=7}if(e.have+h>e.nlen+e.ndist){i.msg="invalid bit length repeat",e.mode=v;break}for(;h--;)e.lens[e.have++]=u}}if(e.mode===v)break;if(e.lens[256]===0){i.msg="invalid code -- missing end-of-block",e.mode=v;break}if(e.lenbits=9,w={bits:e.lenbits},I=H(ut,e.lens,0,e.nlen,e.lencode,0,e.work,w),e.lenbits=w.bits,I){i.msg="invalid literal/lengths set",e.mode=v;break}if(e.distbits=6,e.distcode=e.distdyn,w={bits:e.distbits},I=H(dt,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,w),e.distbits=w.bits,I){i.msg="invalid distances set",e.mode=v;break}if(e.mode=K,t===X)break e;case K:e.mode=J;case J:if(f>=6&&b>=258){i.next_out=l,i.avail_out=b,i.next_in=a,i.avail_in=f,e.hold=r,e.bits=o,Di(i,x),l=i.next_out,s=i.output,b=i.avail_out,a=i.next_in,n=i.input,f=i.avail_in,r=e.hold,o=e.bits,e.mode===B&&(e.back=-1);break}for(e.back=0;p=e.lencode[r&(1<<e.lenbits)-1],g=p>>>24,k=p>>>16&255,y=p&65535,!(g<=o);){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if(k&&!(k&240)){for(c=g,_=k,A=y;p=e.lencode[A+((r&(1<<c+_)-1)>>c)],g=p>>>24,k=p>>>16&255,y=p&65535,!(c+g<=o);){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}r>>>=c,o-=c,e.back+=c}if(r>>>=g,o-=g,e.back+=g,e.length=y,k===0){e.mode=Xe;break}if(k&32){e.back=-1,e.mode=B;break}if(k&64){i.msg="invalid literal/length code",e.mode=v;break}e.extra=k&15,e.mode=We;case We:if(e.extra){for(m=e.extra;o<m;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}e.length+=r&(1<<e.extra)-1,r>>>=e.extra,o-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Ve;case Ve:for(;p=e.distcode[r&(1<<e.distbits)-1],g=p>>>24,k=p>>>16&255,y=p&65535,!(g<=o);){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if(!(k&240)){for(c=g,_=k,A=y;p=e.distcode[A+((r&(1<<c+_)-1)>>c)],g=p>>>24,k=p>>>16&255,y=p&65535,!(c+g<=o);){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}r>>>=c,o-=c,e.back+=c}if(r>>>=g,o-=g,e.back+=g,k&64){i.msg="invalid distance code",e.mode=v;break}e.offset=y,e.extra=k&15,e.mode=je;case je:if(e.extra){for(m=e.extra;o<m;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}e.offset+=r&(1<<e.extra)-1,r>>>=e.extra,o-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){i.msg="invalid distance too far back",e.mode=v;break}e.mode=Ye;case Ye:if(b===0)break e;if(h=x-b,e.offset>h){if(h=e.offset-h,h>e.whave&&e.sane){i.msg="invalid distance too far back",e.mode=v;break}h>e.wnext?(h-=e.wnext,d=e.wsize-h):d=e.wnext-h,h>e.length&&(h=e.length),D=e.window}else D=s,d=l-e.offset,h=e.length;h>b&&(h=b),b-=h,e.length-=h;do s[l++]=D[d++];while(--h);e.length===0&&(e.mode=J);break;case Xe:if(b===0)break e;s[l++]=e.length,b--,e.mode=J;break;case fe:if(e.wrap){for(;o<32;){if(f===0)break e;f--,r|=n[a++]<<o,o+=8}if(x-=b,i.total_out+=x,e.total+=x,e.wrap&4&&x&&(i.adler=e.check=e.flags?C(e.check,s,x,l-x):xe(e.check,s,x,l-x)),x=b,e.wrap&4&&(e.flags?r:Qe(r))!==e.check){i.msg="incorrect data check",e.mode=v;break}r=0,o=0}e.mode=Ke;case Ke:if(e.wrap&&e.flags){for(;o<32;){if(f===0)break e;f--,r+=n[a++]<<o,o+=8}if(e.wrap&4&&r!==(e.total&4294967295)){i.msg="incorrect length check",e.mode=v;break}r=0,o=0}e.mode=Je;case Je:I=Ri;break e;case v:I=xt;break e;case bt:return gt;case wt:default:return T}return i.next_out=l,i.avail_out=b,i.next_in=a,i.avail_in=f,e.hold=r,e.bits=o,(e.wsize||x!==i.avail_out&&e.mode<v&&(e.mode<fe||t!==ve))&&St(i,i.output,i.next_out,x-i.avail_out),E-=i.avail_in,x-=i.avail_out,i.total_in+=E,i.total_out+=x,e.total+=x,e.wrap&4&&x&&(i.adler=e.check=e.flags?C(e.check,s,x,i.next_out-x):xe(e.check,s,x,i.next_out-x)),i.data_type=e.bits+(e.last?64:0)+(e.mode===B?128:0)+(e.mode===K||e.mode===le?256:0),(E===0&&x===0||t===ve)&&I===U&&(I=Fi),I},Wi=i=>{if(O(i))return T;let t=i.state;return t.window&&(t.window=null),i.state=null,U},Vi=(i,t)=>{if(O(i))return T;const e=i.state;return e.wrap&2?(e.head=t,t.done=!1,U):T},ji=(i,t)=>{const e=t.length;let n,s,a;return O(i)||(n=i.state,n.wrap!==0&&n.mode!==te)?T:n.mode===te&&(s=1,s=xe(s,t,e,0),s!==n.check)?xt:(a=St(i,t,e,e),a?(n.mode=bt,gt):(n.havedict=1,U))};var Yi=mt,Xi=yt,Ki=pt,Ji=zi,Qi=_t,qi=Zi,en=Wi,tn=Vi,nn=ji,an="pako inflate (from Nodeca project)",R={inflateReset:Yi,inflateReset2:Xi,inflateResetKeep:Ki,inflateInit:Ji,inflateInit2:Qi,inflate:qi,inflateEnd:en,inflateGetHeader:tn,inflateSetDictionary:nn,inflateInfo:an};function rn(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var sn=rn;const kt=Object.prototype.toString,{Z_NO_FLUSH:on,Z_FINISH:ln,Z_OK:W,Z_STREAM_END:ue,Z_NEED_DICT:de,Z_STREAM_ERROR:fn,Z_DATA_ERROR:et,Z_MEM_ERROR:hn}=ft;function ae(i){this.options=ht.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(i&&i.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ei,this.strm.avail_out=0;let e=R.inflateInit2(this.strm,t.windowBits);if(e!==W)throw new Error(ge[e]);if(this.header=new sn,R.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=be.string2buf(t.dictionary):kt.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=R.inflateSetDictionary(this.strm,t.dictionary),e!==W)))throw new Error(ge[e])}ae.prototype.push=function(i,t){const e=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let a,l,f;if(this.ended)return!1;for(t===~~t?l=t:l=t===!0?ln:on,kt.call(i)==="[object ArrayBuffer]"?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),a=R.inflate(e,l),a===de&&s&&(a=R.inflateSetDictionary(e,s),a===W?a=R.inflate(e,l):a===et&&(a=de));e.avail_in>0&&a===ue&&e.state.wrap>0&&i[e.next_in]!==0;)R.inflateReset(e),a=R.inflate(e,l);switch(a){case fn:case et:case de:case hn:return this.onEnd(a),this.ended=!0,!1}if(f=e.avail_out,e.next_out&&(e.avail_out===0||a===ue))if(this.options.to==="string"){let b=be.utf8border(e.output,e.next_out),r=e.next_out-b,o=be.buf2string(e.output,b);e.next_out=r,e.avail_out=n-r,r&&e.output.set(e.output.subarray(b,b+r),0),this.onData(o)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===W&&f===0)){if(a===ue)return a=R.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};ae.prototype.onData=function(i){this.chunks.push(i)};ae.prototype.onEnd=function(i){i===W&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ht.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function cn(i,t){const e=new ae(t);if(e.push(i),e.err)throw e.msg||ge[e.err];return e.result}var un=cn,dn={inflate:un};const{inflate:xn}=dn;var gn=xn;function bn(i){const t=new Uint8Array(i.buffer,i.byteOffset,i.byteLength),e=gn(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}const wn={ignoreImageData:!1};class $ extends ie{constructor(e){super(e);P(this,"_nextIFD");this._nextIFD=0}get isMultiPage(){let e=0;for(this.decodeHeader();this._nextIFD;)if(e++,this.decodeIFD({ignoreImageData:!0},!0),e===2)return!0;if(e===1)return!1;throw L("ifdCount",e)}get pageCount(){let e=0;for(this.decodeHeader();this._nextIFD;)e++,this.decodeIFD({ignoreImageData:!0},!0);if(e>0)return e;throw L("ifdCount",e)}decode(e={}){const{pages:n}=e;pn(n);const s=n?Math.max(...n):1/0;e={...wn,...e};const a=[];this.decodeHeader();let l=0;for(;this._nextIFD;){if(n){if(n.includes(l)?a.push(this.decodeIFD(e,!0)):this.decodeIFD({ignoreImageData:!0},!0),l===s)break}else a.push(this.decodeIFD(e,!0));l++}if(l<s&&s!==1/0)throw new RangeError(`Index ${s} is out of bounds. The stack only contains ${l} images.`);return a}decodeHeader(){const e=this.readUint16();if(e===18761)this.setLittleEndian();else if(e===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${e.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(e,n){this.seek(this._nextIFD);let s;if(n)s=new Ee;else{if(!e.kind)throw new Error("kind is missing");s=new rt(e.kind)}const a=this.readUint16();for(let l=0;l<a;l++)this.decodeIFDEntry(s);if(!e.ignoreImageData){if(!(s instanceof Ee))throw new Error("must be a tiff ifd");this.decodeImageData(s)}return this._nextIFD=this.readUint32(),s}decodeIFDEntry(e){const n=this.offset,s=this.readUint16(),a=this.readUint16(),l=this.readUint32();if(a<1||a>12){this.skip(4);return}Ft(a,l)>4&&this.seek(this.readUint32());const b=Ut(this,a,l);if(e.fields.set(s,b),s===34665||s===34853){const r=this.offset;let o="exif";s===34665?o="exif":s===34853&&(o="gps"),this._nextIFD=b,e[o]=this.decodeIFD({kind:o,ignoreImageData:!0},!1),this.offset=r}this.seek(n),this.skip(12)}decodeImageData(e){const n=e.orientation;if(n&&n!==1)throw L("orientation",n);switch(e.type){case 0:case 1:case 2:case 3:e.tiled?this.readTileData(e):this.readStripData(e);break;default:throw L("image type",e.type)}if(this.applyPredictor(e),this.convertAlpha(e),e.bitsPerSample===1&&this.split1BitData(e),e.type===0){const a=2**e.bitsPerSample-1;for(let l=0;l<e.data.length;l++)e.data[l]=a-e.data[l]}}split1BitData(e){const{imageWidth:n,imageLength:s,samplesPerPixel:a}=e,l=new Uint8Array(s*n*a),f=Math.ceil(n*a/8);let b=0;for(let r=0;r<s;r++){const o=r*f;for(let E=0;E<n*a;E++){const x=o+Math.floor(E/8),h=7-E%8,d=e.data[x]>>h&1;l[b++]=d}}e.data=l}static uncompress(e,n=1){switch(n){case 1:return e;case 5:return qt(e);case 8:case 32946:return bn(e);case 2:throw L("Compression","CCITT Group 3");case 32773:throw L("Compression","PackBits");default:throw L("Compression",n)}}createSampleReader(e,n,s){if(n===8||n===1)return(a,l)=>a.getUint8(l);if(n===16)return(a,l)=>a.getUint16(2*l,s);if(n===32&&e===3)return(a,l)=>a.getFloat32(4*l,s);if(n===64&&e===3)return(a,l)=>a.getFloat64(8*l,s);throw L("bitDepth",n)}readStripData(e){const n=e.width,s=e.height,a=e.bitsPerSample!==1?n*e.samplesPerPixel*s:Math.ceil(n*e.samplesPerPixel/8)*s,l=e.stripOffsets,f=e.stripByteCounts||Lt(e),b=this.isLittleEndian(),r=e.bitsPerSample!==1?n*e.samplesPerPixel*e.rowsPerStrip:Math.ceil(n*e.samplesPerPixel/8)*e.rowsPerStrip,o=this.createSampleReader(e.sampleFormat,e.bitsPerSample,b),E=tt(a,e.bitsPerSample,e.sampleFormat);let x=0;for(let h=0;h<l.length;h++){const d=new DataView(this.buffer,this.byteOffset+l[h],f[h]),D=$.uncompress(d,e.compression),p=Math.min(r,a-x);for(let g=0;g<p;++g){const k=o(D,g);E[x+g]=k}x+=p}e.data=E}readTileData(e){if(!e.tileWidth||!e.tileHeight)return;const n=e.width,s=e.height,a=e.bitsPerSample!==1?n*s*e.samplesPerPixel:Math.ceil(n*e.samplesPerPixel/8)*s,l=e.tileWidth,f=e.tileHeight,b=Math.ceil(n/l),r=Math.ceil(s/f),o=e.tileOffsets,E=e.tileByteCounts,x=this.isLittleEndian(),h=this.createSampleReader(e.sampleFormat,e.bitsPerSample,x),d=tt(a,e.bitsPerSample,e.sampleFormat);for(let D=0;D<b;++D)for(let p=0;p<r;++p){const g=p*b+D,k=new DataView(this.buffer,this.byteOffset+o[g],E[g]),y=$.uncompress(k,e.compression);if(e.bitsPerSample===1){const c=Math.ceil(n/8),_=Math.ceil(l/8);for(let A=0;A<f&&p*f+A<s;A++){const u=p*f+A,I=A*_,S=u*c+Math.floor(D*l/8),w=Math.min(_,c-Math.floor(D*l/8));for(let m=0;m<w;m++)d[S+m]=h(y,I+m)}}else for(let c=0;c<f;c++)for(let _=0;_<l;_++){const A=D*l+_,u=p*f+c;if(A>=n||u>=s)continue;const I=c*l+_,S=h(y,I),w=(u*n+A)*e.samplesPerPixel;d[w]=S}}e.data=d}applyPredictor(e){const n=e.bitsPerSample;switch(e.predictor){case 1:break;case 2:{if(n===8)Rt(e.data,e.width,e.components);else if(n===16)Mt(e.data,e.width,e.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${n}`);break}default:throw new Error(`invalid predictor: ${e.predictor}`)}}convertAlpha(e){if(e.alpha&&e.associatedAlpha){const{data:n,components:s,maxSampleValue:a}=e;for(let l=0;l<n.length;l+=s){const f=n[l+s-1];for(let b=0;b<s-1;b++)n[l+b]=Math.round(n[l+b]*a/f)}}}}function tt(i,t,e){if(t===8||t===1)return new Uint8Array(i);if(t===16)return new Uint16Array(i);if(t===32&&e===3)return new Float32Array(i);if(t===64&&e===3)return new Float64Array(i);throw L("bit depth / sample format",`${t} / ${e}`)}function L(i,t){return new Error(`Unsupported ${i}: ${t}`)}function pn(i){if(i){for(const t of i)if(t<0||!Number.isInteger(t))throw new RangeError(`Index ${t} is invalid. Must be a positive integer.`)}}function yn(i,t){return new $(i).decode(t)}function _n(i){return new $(i).isMultiPage}function Sn(i){return new $(i).pageCount}const kn={exif:Q,gps:q,standard:ee};export{Ee as TiffIfd,yn as decode,_n as isMultiPage,Sn as pageCount,kn as tagNames};
